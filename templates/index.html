<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canyon Lake Water Level Monitor | Real-Time Texas Lake Levels</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Real-time Canyon Lake water level monitoring in Texas. Check current lake elevation, percentage full, weather, and 30-day historical data for Canyon Lake near New Braunfels, TX.">
    <meta name="keywords" content="Canyon Lake, Texas, water level, lake levels, New Braunfels, USGS, lake monitor, Guadalupe River, Texas lakes, water conservation, lake status">
    <meta name="author" content="Richard Hasting">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://isthelakefull.com/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://isthelakefull.com/">
    <meta property="og:title" content="Is Canyon Lake Full Yet? | Real-Time Water Level Monitor">
    <meta property="og:description" content="Check real-time water levels for Canyon Lake in Texas. View current elevation, percentage full, weather conditions, and historical trends.">
    <meta property="og:site_name" content="Canyon Lake Monitor">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://isthelakefull.com/">
    <meta property="twitter:title" content="Is Canyon Lake Full Yet? | Real-Time Water Level Monitor">
    <meta property="twitter:description" content="Check real-time water levels for Canyon Lake in Texas. View current elevation, percentage full, weather conditions, and historical trends.">

    <!-- Geographic Tags -->
    <meta name="geo.region" content="US-TX">
    <meta name="geo.placename" content="Canyon Lake, Texas">
    <meta name="geo.position" content="29.8719;-98.2697">
    <meta name="ICBM" content="29.8719, -98.2697">

    <!-- Structured Data (Schema.org) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Canyon Lake Water Level Monitor",
      "url": "https://isthelakefull.com/",
      "description": "Real-time Canyon Lake water level monitoring for Canyon Lake, Texas",
      "author": {
        "@type": "Person",
        "name": "Richard Hasting"
      },
      "about": {
        "@type": "LakeBodyOfWater",
        "name": "Canyon Lake",
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": "29.8719",
          "longitude": "-98.2697"
        },
        "address": {
          "@type": "PostalAddress",
          "addressRegion": "TX",
          "addressCountry": "US"
        }
      },
      "provider": {
        "@type": "GovernmentOrganization",
        "name": "U.S. Geological Survey",
        "url": "https://waterservices.usgs.gov/"
      }
    }
    </script>

    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <h1 style="font-size: 24pt; margin-bottom: 10px;">Is Canyon Lake full yet?</h1>
        <div id="answer" style="font-size: 30pt; font-weight: bold; text-align: center; margin-bottom: 30px;">-</div>
        
        <div id="loading" class="loading">Loading lake data...</div>
        
        <div id="content" style="display: none;">
            <div class="lake-container">
                <div class="gauge">
                    <div class="gauge-marker" style="bottom: 100%"><span>100%</span></div>
                    <div class="gauge-marker" style="bottom: 90%"><span>90%</span></div>
                    <div class="gauge-marker" style="bottom: 80%"><span>80%</span></div>
                    <div class="gauge-marker" style="bottom: 70%"><span>70%</span></div>
                    <div class="gauge-marker" style="bottom: 60%"><span>60%</span></div>
                    <div class="gauge-marker" style="bottom: 50%"><span>50%</span></div>
                    <div class="gauge-marker" style="bottom: 40%"><span>40%</span></div>
                    <div class="gauge-marker" style="bottom: 30%"><span>30%</span></div>
                    <div class="gauge-marker" style="bottom: 20%"><span>20%</span></div>
                    <div class="gauge-marker" style="bottom: 10%"><span>10%</span></div>
                    <div class="gauge-marker" style="bottom: 0%"><span>0%</span></div>
                </div>
                <div class="lake-visual">
                    <div id="water" class="water">
                        <span class="percentage" id="percentage">0%</span>
                    </div>
                </div>
            </div>
            
            <div id="status-message" class="status-message"></div>
            
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-label">Current Elevation</div>
                    <div class="stat-value" id="elevation">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Conservation Pool</div>
                    <div class="stat-value" id="conservation">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Below Full</div>
                    <div class="stat-value" id="below-normal">-</div>
                </div>
            </div>

            <div class="stats" style="margin-top: 20px;">
                <div class="stat-box">
                    <div class="stat-label">Temperature</div>
                    <div class="stat-value" id="temperature">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Moon Phase</div>
                    <div class="stat-value" id="moon-phase">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Sunrise / Sunset</div>
                    <div class="stat-value" id="sun-times" style="font-size: 0.9em;">-</div>
                </div>
            </div>
            
            <div class="last-updated" id="last-updated"></div>
            
            <div style="text-align: center;">
                <a href="/chart" class="nav-link">View 30-Day History</a>
                {% if show_analytics %}
                <a href="/analytics" class="nav-link" style="margin-left: 10px;">View Site Analytics</a>
                {% endif %}
            </div>
        </div>
        
        <div id="error" class="error" style="display: none;">
            Unable to load lake data. Please try again later.
        </div>
    </div>
    
    <script>
        async function fetchLakeData() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();

                if (data.status === 'success') {
                    updateDisplay(data);
                } else {
                    showError();
                }
            } catch (error) {
                console.error('Error fetching data:', error);
                showError();
            }
        }

        async function fetchEnvironmentData() {
            try {
                const response = await fetch('/api/environment');
                const data = await response.json();

                if (data.status === 'success') {
                    updateEnvironmentDisplay(data);
                }
            } catch (error) {
                console.error('Error fetching environment data:', error);
            }
        }

        function updateEnvironmentDisplay(data) {
            // Update temperature
            if (data.temperature !== null) {
                document.getElementById('temperature').textContent = data.temperature + 'Â°F';
            } else {
                document.getElementById('temperature').textContent = 'N/A';
            }

            // Update moon phase
            if (data.moon_emoji && data.moon_phase) {
                document.getElementById('moon-phase').textContent = data.moon_emoji + ' ' + data.moon_phase;
            }

            // Update sunrise/sunset
            if (data.sunrise && data.sunset) {
                document.getElementById('sun-times').textContent = data.sunrise + ' / ' + data.sunset;
            }

            // Apply theme based on day/night
            if (data.is_daytime === false) {
                document.body.classList.add('night-mode');
            } else {
                document.body.classList.remove('night-mode');
            }
        }
        
        function updateDisplay(data) {
            // Hide loading, show content
            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            
            // Update answer based on percentage
            const answer = document.getElementById('answer');
            if (data.percentage_full >= 105) {
                answer.textContent = 'Maybe a bit too much?';
            } else if (data.percentage_full >= 98) {
                answer.textContent = 'YES!';
            } else {
                answer.textContent = 'NOPE!';
            }
            
            // Update water level visual
            const water = document.getElementById('water');
            water.style.height = data.percentage_full + '%';
            water.className = 'water ' + data.status_category;
            
            // Update percentage
            document.getElementById('percentage').textContent = data.percentage_full + '%';
            
            // Update stats
            document.getElementById('elevation').textContent = data.elevation.toFixed(2) + ' ft';
            document.getElementById('conservation').textContent = data.conservation_pool.toFixed(2) + ' ft';
            document.getElementById('below-normal').textContent = data.feet_below_conservation.toFixed(2) + ' ft';
            
            // Update status message
            const statusMessage = document.getElementById('status-message');
            statusMessage.className = 'status-message ' + data.status_category;
            
            let message = '';
            switch(data.status_category) {
                case 'flood':
                    message = 'WARNING: Lake is above flood stage!';
                    break;
                case 'full':
                    message = 'Lake is at full conservation capacity.';
                    break;
                case 'excellent':
                    message = 'Lake levels are excellent!';
                    break;
                case 'good':
                    message = 'Lake levels are good.';
                    break;
                case 'low':
                    message = 'Lake levels are low. Please conserve water.';
                    break;
                case 'critical':
                    message = 'Lake levels are critically low. Please conserve water.';
                    break;
            }
            statusMessage.textContent = message;
            
            // Update last updated time
            const lastUpdated = new Date(data.timestamp);
            document.getElementById('last-updated').textContent = 
                'Last updated: ' + lastUpdated.toLocaleString();
        }
        
        function showError() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'none';
            document.getElementById('error').style.display = 'block';
        }
        
        // Fetch data on load
        fetchLakeData();
        fetchEnvironmentData();

        // Refresh every 5 minutes
        setInterval(() => {
            fetchLakeData();
            fetchEnvironmentData();
        }, 5 * 60 * 1000);
    </script>
</body>
</html>